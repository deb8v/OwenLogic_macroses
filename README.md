# Набор макросов Owen Logic.

Часть алгоритмов была позаимствована с форума Owen.
Огромная благодарность [Юрию Ревака]() за вклад в развитие платформы.

1. [Дата и время](#p1.1) 

2. [Инструменты]()

3. [Математика]()

4. [Фильтры]()

5. Связь

   

<hr>
0.Структуризация

- [ ] Распихать всё по папкам
- [ ] Найти того несчастного кто подгонит еще ПР200 но с Modbus для тестов
- [ ] Избавить от архаичных зависимостей в библиотеках 

2.дата и время

- [x] Timestamp -> Человеческий формат;   Человеческий формат -> Timestamp
- [ ] Фазы луны
- [x] Инструмент работы с днём недели
- [x] Астрономический таймер
- [ ] Вычисление дней до сезона

3.инструменты

- [x] NTC термистор [NTC]
- [x] Энкодер [Энкодер] (возможны ошибки)
- [x] Многофункциональные кнопки
- [x] Частотомер по количеству за период
- [ ] Частотомер по периоду
- [ ] Управление ПЧ ONI Modbus

4.Le Matan

- [x] Радианы ->  Градусы; Градусы -> Радианы

- [ ] ceil() floor()
- [x] sq() sqrt()
- [x] log() 
- [ ] exp()
- [x] acos, asin, atg
- [x] cos, sin, tg
- [x]  map(v,min,max,Tmin,Tmax)
- [ ] max, min
- [ ] **random**
- [x] FastPID
- [x] PLA
- [x] SORT (n9,n10,n16) сравнение без задержки.
- [ ] SORT (<16) на массивах
- [x] Ячейки памяти Float Int

5.фильтры

[Уроки Arduino. Фильтры данных, обработка сигналов](https://www.youtube.com/watch?v=R6yvl90TiI8)

Моментальной реакции:

- [x] Среднее арифметическое [RA]
- [x] MID3 по таймеру встроенному [Mid3]
- [ ] MID3 по факту обновления
- [x] MID9 по факту обновления
- [ ] MID
- [ ] Калман [SKF]
- [ ] Альфа-Бета фильтр [ABF]

С задержкой расчёта:

- [x] Среднее арифметическое с периодом выборки [AVGn]
- [ ] Среднее квадратичное 



6. Связь (нужен второй прибор)

   - [ ] буфер односторонний по одному проводу

   - [ ] буфер двухсторонний по одному проводу

<hr>

# 1 **дата и время** <a name="p1.1"></a>

### 1.1 преобразование **Timestamp** в человеческий формат 

*/Дата и время/UNIX_to_DT.tpl*

| Входные параметры                                            | Описание                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| <img src="https://sun9-10.userapi.com/impg/OZEWVjS0d7mSCjHkYliBUy1bOXABaUWLE2LnCg/yKGxxJ0TNFU.jpg?size=290x241&quality=96&sign=7756fb49e9e8b83122149d553f02a6a7&type=album" alt="image-20210702203603917"  /> | В свойствах макроса:<br />*Смещение часового пояса Минут*<br />*Смещение часового пояса Часов* |

<hr>

### 1.2 обработка дня недели<a name="p1.2"></a>

*Дата и время/WD.tpl*



| Входные данные                                               | Описание                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| ![image-20210702222311962](https://sun9-55.userapi.com/impg/ELiuK8S3igZpgiDSULMumgyng2PI0AMNRZLJ7g/8sUv4oqOHM4.jpg?size=411x129&quality=96&sign=b4b9f519d730cf095b90bdba8e9939aa&type=album) | Выводит день недели двух видов.<br />1. Порядковый 2. Позицией бита |

| День недели | Вывод численный | Вывод кодированный | 2^n  |
| :---------- | --------------- | ------------------ | ---- |
| Понедельник | 1               | 2                  | 1    |
| Вторник     | 2               | 4                  | 2    |
| Среда       | 3               | 8                  | 3    |
| Четверг     | 4               | 16                 | 4    |
| Пятница     | 5               | 32                 | 5    |
| Суббота     | 6               | 64                 | 6    |
| Воскресенье | 0               | 1                  | 0    |

**Use cases**:

| Пример                           | Описание                                                     | Иллюстрация                                             |
| -------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------- |
| Использование кодируемого вывода | <P>Например в торговом центре во вторник, среду, четверг и воскресенье самый маленький поток людей, для создания видимости наполненности заставим людей ходить кругами чтобы спуститься.</P><br />В основном люди используют прямые условия IF объединённых OR.</p><P> Но это вовсе не обязательно когда существуют битовые маски. Используя логическое И (AND &) мы можем узнать, совпадают ли биты на нужных местах в обоих числах.</P><br>4+8+16+1=29<sub>10</sub>=00011101<sub>2</sub>    11101<sub>2</sub>^01000<sub>2</sub>=1000<sub>2</sub>; 11101<sub>2</sub>^10<sub>2</sub>=0<sub>2</sub>; | [Видео работы](https://vk.com/video197651328_456239541) |



### 1.3 астрономический таймер<a name="p1.3"></a>

*/Дата и время/AST.tpl*

Астрономический таймер это устройство позволяющее по углу солнца извлечь время рассвета и заката только силами математики.
Можно выставить нужные солнечные углы и проектировать уличное освещение или подсветку рекламных щитов под фон небосвода.

Области применения:

- Отключение подсветки коридоров
- Управление уличным освещением без влияния внеших факторов
- Качественное управление подсветкой арт объектов под требования дизайнера
- Возможность отключать уличное освещение с первыми лучами солнца
- Высокая надёжность системы не подверженная внешним факторам
- Повышение отказоустойчивости для ламп высокого давления (ДНАТ)

![](https://sun9-33.userapi.com/impg/kBC-eY7AMH3nmTe8ryi1KIqolmR4qI1X-oMaAw/6eF1D2Z7Bnc.jpg?size=1459x897&quality=96&sign=041d6b7ad6578752992173de505e4339&type=album)

| Входные данные                                               | Описание                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| ![](https://sun9-8.userapi.com/impg/XQkU6yBqxaE1qKQVKbXuIGrQr1bRnzH_PkqGdA/rc1GBuRlL-Y.jpg?size=350x190&quality=96&sign=576925d031824cf1c6a5b80f6393fb8f&type=album)![](https://sun9-70.userapi.com/impg/bnQUpVrewTsetUHLJkONlxZlMw-L4dB2Drk-4g/FmGJCY3IYm0.jpg?size=280x164&quality=96&sign=30cc1bc96beb8faa2070dae66797617d&type=album) | Существует возможность указать отклонение требуемого угла от плоскости как в настройках макроса так и на ходу. Например для разных дней недели или условий работы, идей, желаний, всегда выбирается последний из измененных.<br />К выводу доступны часы заката, рассвета в привычных Часы Минуты но доступен и формат Timestamp для использования в ваших формулах и алгоритмах.<br />В случае если смена суток не произойдет то на выводе ***Полярная ночь*** будет высокий сигнал. |



